<Window x:Class="PDFOrtnerSorter.Dialogs.JobDetailsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:PDFOrtnerSorter.Infrastructure"
        mc:Ignorable="d"
        Title="Job Details" Height="600" Width="800"
        WindowStartupLocation="CenterOwner"
        Background="{DynamicResource {x:Static SystemColors.WindowBrushKey}}">
    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        <local:BooleanToTextConverter x:Key="BooleanToTextConverter"/>
        <local:BooleanToTextConverter x:Key="StatusConverter" TrueText="Erfolg" FalseText="Fehler"/>
        
        <Style TargetType="GroupBox">
            <Setter Property="Margin" Value="0,0,0,12"/>
            <Setter Property="Padding" Value="8"/>
            <Setter Property="BorderBrush" Value="#CCCCCC"/>
            <Setter Property="BorderThickness" Value="1"/>
        </Style>
        <Style TargetType="TextBlock" x:Key="LabelStyle">
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Margin" Value="0,0,8,0"/>
        </Style>
    </Window.Resources>
    
    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <GroupBox Header="Job Informationen" Grid.Row="0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="120"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Row="0" Grid.Column="0" Style="{StaticResource LabelStyle}" Text="Job ID:"/>
                <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding Job.Id}"/>

                <TextBlock Grid.Row="1" Grid.Column="0" Style="{StaticResource LabelStyle}" Text="Ordnername:"/>
                <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding Job.FolderName}" FontWeight="Bold"/>

                <TextBlock Grid.Row="2" Grid.Column="0" Style="{StaticResource LabelStyle}" Text="Status:"/>
                <TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding Job.Status}"/>

                <TextBlock Grid.Row="3" Grid.Column="0" Style="{StaticResource LabelStyle}" Text="Erstellt:"/>
                <TextBlock Grid.Row="3" Grid.Column="1" Text="{Binding Job.CreatedAt, StringFormat='{}{0:dd.MM.yyyy HH:mm:ss}'}"/>

                <TextBlock Grid.Row="4" Grid.Column="0" Style="{StaticResource LabelStyle}" Text="Abgeschlossen:"/>
                <TextBlock Grid.Row="4" Grid.Column="1" Text="{Binding Job.CompletedAt, StringFormat='{}{0:dd.MM.yyyy HH:mm:ss}', TargetNullValue='Noch nicht abgeschlossen'}"/>
            </Grid>
        </GroupBox>

        <!-- Content Tabs -->
        <TabControl Grid.Row="1" Margin="0,8,0,0">
            <!-- Files Tab -->
            <TabItem Header="Dateien">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <TextBlock Grid.Row="0" Margin="0,8,0,8">
                        <Run Text="Gesamt: "/>
                        <Run Text="{Binding Job.TotalFileCount, Mode=OneWay}" FontWeight="Bold"/>
                        <Run Text=" | Erfolgreich: "/>
                        <Run Text="{Binding Job.SuccessfulFileCount, Mode=OneWay}" FontWeight="Bold" Foreground="Green"/>
                        <Run Text=" | Fehlgeschlagen: "/>
                        <Run Text="{Binding Job.FailedFileCount, Mode=OneWay}" FontWeight="Bold" Foreground="Red"/>
                    </TextBlock>

                    <DataGrid Grid.Row="1"
                              ItemsSource="{Binding Job.Files}"
                              AutoGenerateColumns="False"
                              IsReadOnly="True"
                              SelectionMode="Single"
                              GridLinesVisibility="Horizontal"
                              HeadersVisibility="Column"
                              CanUserResizeRows="False"
                              CanUserSortColumns="True">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Dateiname" Binding="{Binding FileName}" Width="*"/>
                            <DataGridTextColumn Header="Größe" Binding="{Binding SizeBytes, StringFormat='{}{0:N0} Bytes'}" Width="120"/>
                            <DataGridTextColumn Header="Status" Width="100">
                                <DataGridTextColumn.Binding>
                                    <Binding Path="IsSuccessful" Converter="{StaticResource StatusConverter}" />
                                </DataGridTextColumn.Binding>
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsSuccessful}" Value="True">
                                                <Setter Property="Foreground" Value="Green"/>
                                                <Setter Property="FontWeight" Value="Bold"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding IsSuccessful}" Value="False">
                                                <Setter Property="Foreground" Value="Red"/>
                                                <Setter Property="FontWeight" Value="Bold"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>
                            <DataGridTextColumn Header="Fehlermeldung" Binding="{Binding ErrorMessage}" Width="*"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </TabItem>

            <!-- Errors Tab -->
            <TabItem Header="Fehler">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <TextBlock Grid.Row="0" Margin="0,8,0,8" Visibility="{Binding HasNoErrors, Converter={StaticResource BooleanToVisibilityConverter}}">
                        <Run Text="Keine Fehler aufgetreten" FontWeight="Bold" Foreground="Green"/>
                    </TextBlock>

                    <DataGrid Grid.Row="1"
                              ItemsSource="{Binding Job.Errors}"
                              AutoGenerateColumns="False"
                              IsReadOnly="True"
                              SelectionMode="Single"
                              GridLinesVisibility="Horizontal"
                              HeadersVisibility="Column"
                              CanUserResizeRows="False"
                              CanUserSortColumns="True"
                              Visibility="{Binding HasErrors, Converter={StaticResource BooleanToVisibilityConverter}}">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Dateiname" Binding="{Binding FileName}" Width="*"/>
                            <DataGridTextColumn Header="Fehlertyp" Binding="{Binding ErrorType}" Width="120"/>
                            <DataGridTextColumn Header="Fehlermeldung" Binding="{Binding ErrorMessage}" Width="*"/>
                            <DataGridTextColumn Header="Wiederholungen" Binding="{Binding RetryCount}" Width="100"/>
                            <DataGridTextColumn Header="Zeitstempel" Binding="{Binding Timestamp, StringFormat='{}{0:dd.MM.yyyy HH:mm:ss}'}" Width="140"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </TabItem>
        </TabControl>

        <!-- Footer Buttons -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,12,0,0">
            <Button Content="Fehlerhafte Dateien wiederholen"
                    Command="{Binding RetryFailedFilesCommand}"
                    Visibility="{Binding CanRetry, Converter={StaticResource BooleanToVisibilityConverter}}"
                    Padding="12,6"
                    Margin="0,0,8,0"
                    Background="#FF4CAF50"
                    Foreground="White"
                    BorderThickness="0"
                    Cursor="Hand"/>
            
            <Button Content="Schließen"
                    IsCancel="True"
                    Padding="12,6"
                    MinWidth="80"/>
        </StackPanel>
    </Grid>
</Window>
